<% layout('layouts/layout') %>

<% if (errors && errors.length > 0) { %>
  <div class="errors">
    <% errors.forEach(error => { %>
      <p class="error"><%= error.msg %></p>
    <% }); %>
  </div>
<% } %>

<% if (message) { %>
  <div class="message">
    <%= message %>
  </div>
<% } %>

<h1><%= title %></h1>

<form id="accountUpdateForm" method="post" action="/account/update/account" class="form">
  <fieldset>
    <legend>Account Update</legend>
    <input type="hidden" name="account_id" value="<%= account_id %>">
    
    <label for="account_firstname">First Name</label>
    <input type="text" name="account_firstname" id="account_firstname" value="<%= account_firstname || '' %>" required>
    
    <label for="account_lastname">Last Name</label>
    <input type="text" name="account_lastname" id="account_lastname" value="<%= account_lastname || '' %>" required>
    
    <label for="account_email">Email Address</label>
    <input type="email" name="account_email" id="account_email" value="<%= account_email || '' %>" required>
    
    <input type="submit" value="Update Account" class="btn btn-primary">
  </fieldset>
</form>

<form id="passwordUpdateForm" method="post" action="/account/update/password" class="form">
  <fieldset>
    <legend>Change Password</legend>
    <input type="hidden" name="account_id" value="<%= account_id %>">
    
    <p class="password-info">Password requirements: At least 12 characters with at least 1 capital letter, 1 number and 1 special character.</p>
    
    <label for="current_password">Current Password</label>
    <input type="password" name="current_password" id="current_password" required>
    
    <label for="account_password">New Password</label>
    <input type="password" name="account_password" id="account_password" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s]).{12,}$" title="Password must contain at least 1 capital letter, 1 lowercase letter, 1 number, 1 special character and be at least 12 characters long" required>
    
    <input type="submit" value="Change Password" class="btn btn-secondary">
  </fieldset>
</form>

<p><a href="/account/">Back to Account Management</a></p>

<script>
// Client-side validation
document.addEventListener('DOMContentLoaded', function() {
  const accountForm = document.getElementById('accountUpdateForm');
  const passwordForm = document.getElementById('passwordUpdateForm');
  
  accountForm.addEventListener('submit', function(e) {
    const firstname = document.getElementById('account_firstname').value.trim();
    const lastname = document.getElementById('account_lastname').value.trim();
    const email = document.getElementById('account_email').value.trim();
    
    if (!firstname || !lastname || !email) {
      alert('All fields are required.');
      e.preventDefault();
      return;
    }
    
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
      alert('Please enter a valid email address.');
      e.preventDefault();
      return;
    }
  });
  
  passwordForm.addEventListener('submit', function(e) {
    const currentPassword = document.getElementById('current_password').value;
    const password = document.getElementById('account_password').value;
    const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s]).{12,}$/;
    
    if (!currentPassword) {
      alert('Current password is required.');
      e.preventDefault();
      return;
    }
    
    if (!passwordPattern.test(password)) {
      alert('Password must contain at least 1 capital letter, 1 lowercase letter, 1 number, 1 special character and be at least 12 characters long.');
      e.preventDefault();
      return;
    }
  });
});
</script>
